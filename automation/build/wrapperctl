#!/bin/bash
# Runs the Achel app from within the docker container.

# Figure out which app we are.
# NOTE that namespacing comes for free for the command since achelctl is hardcoded as the command, but not the image.
fileName=`basename $0`
appName=${fileName::-3}

# This gives us optional namespacing.
image=`echo $appName | cut -d- -f1`

# Make sure we aren't being run directly.
if [ "$appName" == 'wrapper' ]; then
  echo "This is not intended to be run directly." >&2
  exit 1
fi

# Assert that the configuration directory exists.
mkdir -p ~/.achel-$appName

# Let's do it!
docker run -it  --env COMMAND=achelctl --volume ~/.achel-$appName:/etc/achel --volume `pwd`:/current kjsandom/$image /usr/installs/achel/automation/dockerInternal/internalWrapper "$@"
